<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Field Training - LendWise Mortgage</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 1400px;
      padding: 30px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
    }

    .header h1 {
      color: #333;
      font-size: 32px;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 16px;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .panel {
      background: #f9f9f9;
      border-radius: 10px;
      padding: 20px;
      border: 1px solid #e0e0e0;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #667eea;
    }

    .panel-title {
      font-size: 20px;
      font-weight: 600;
      color: #333;
    }

    .recordings-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .recording-item {
      background: white;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.3s;
    }

    .recording-item:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    }

    .recording-item.selected {
      background: linear-gradient(135deg, #667eea10, #764ba210);
      border-color: #667eea;
    }

    .recording-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      font-size: 14px;
    }

    .info-label {
      color: #666;
      font-weight: 500;
    }

    .info-value {
      color: #333;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }

    .status-trained {
      background: #d4ffd4;
      color: #008800;
    }

    .status-pending {
      background: #fff4d4;
      color: #888800;
    }

    .transcript-viewer {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      line-height: 1.8;
    }

    .utterance {
      margin-bottom: 15px;
      padding: 10px;
      border-left: 3px solid transparent;
      transition: all 0.3s;
    }

    .utterance:hover {
      background: #f0f0f0;
    }

    .speaker-a {
      border-left-color: #667eea;
    }

    .speaker-b {
      border-left-color: #764ba2;
    }

    .speaker-label {
      font-weight: bold;
      color: #667eea;
      margin-bottom: 5px;
    }

    .utterance-text {
      color: #333;
      cursor: text;
      user-select: text;
    }

    .utterance-text::selection {
      background: #667eea40;
    }

    .marked-field {
      background: #ffeb3b;
      padding: 2px 4px;
      border-radius: 3px;
      position: relative;
      cursor: pointer;
    }

    .field-tag {
      position: absolute;
      top: -20px;
      left: 0;
      background: #667eea;
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
      white-space: nowrap;
    }

    .fields-panel {
      grid-column: 1 / -1;
    }

    .field-categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .field-category {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .category-title {
      font-weight: 600;
      color: #667eea;
      margin-bottom: 10px;
      font-size: 14px;
      text-transform: uppercase;
    }

    .field-button {
      display: block;
      width: 100%;
      padding: 8px;
      margin-bottom: 5px;
      background: #f0f0f0;
      border: 1px solid #d0d0d0;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
    }

    .field-button:hover {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .field-button.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 30px;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    .audio-player {
      background: #333;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }

    audio {
      width: 100%;
    }

    .instructions {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .instructions h3 {
      color: #856404;
      margin-bottom: 10px;
    }

    .instructions ol {
      margin-left: 20px;
      color: #856404;
    }

    .instructions li {
      margin-bottom: 5px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .marked-count {
      background: #667eea;
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 5px;
    }

    .training-stats {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .stat-card {
      background: white;
      padding: 15px 25px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }

    .stat-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéØ AI Field Training System</h1>
      <p>Train the AI to extract specific mortgage data fields from call transcripts</p>
    </div>

    <div class="instructions">
      <h3>üìã How to Train the AI:</h3>
      <ol>
        <li>Select a recording from the list on the left</li>
        <li>Click on a field type from the categories below</li>
        <li>Highlight the text in the transcript that contains that information</li>
        <li>The AI will learn to identify similar patterns in future calls</li>
        <li>Click "Save Training Data" when you're done marking fields</li>
      </ol>
    </div>

    <div class="training-stats">
      <div class="stat-card">
        <div class="stat-value" id="totalRecordings">0</div>
        <div class="stat-label">Total Recordings</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="trainedRecordings">0</div>
        <div class="stat-label">Trained</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="fieldsMarked">0</div>
        <div class="stat-label">Fields Marked</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="accuracyScore">0%</div>
        <div class="stat-label">AI Accuracy</div>
      </div>
    </div>

    <div class="main-grid">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">üìû Available Recordings</div>
          <button class="btn btn-secondary" onclick="refreshRecordings()">Refresh</button>
        </div>
        <div class="recordings-list" id="recordingsList">
          <div class="loading">
            <div class="spinner"></div>
            <p>Loading recordings...</p>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">üìù Transcript</div>
          <div id="currentField" style="color: #667eea; font-weight: 600;"></div>
        </div>
        <div class="transcript-viewer" id="transcriptViewer">
          <p style="color: #999; text-align: center; padding: 40px;">
            Select a recording to view its transcript
          </p>
        </div>
        <div class="audio-player" id="audioPlayer" style="display: none;">
          <audio controls id="audioElement"></audio>
        </div>
      </div>
    </div>

    <div class="panel fields-panel">
      <div class="panel-header">
        <div class="panel-title">üéØ Field Categories</div>
        <div>Click a field type, then highlight the corresponding text in the transcript</div>
      </div>

      <div class="field-categories">
        <div class="field-category">
          <div class="category-title">Borrower Information</div>
          <button class="field-button" data-field="full_name">Full Name <span class="marked-count" id="count_full_name" style="display:none">0</span></button>
          <button class="field-button" data-field="phone_number">Phone Number <span class="marked-count" id="count_phone_number" style="display:none">0</span></button>
          <button class="field-button" data-field="email_address">Email Address <span class="marked-count" id="count_email_address" style="display:none">0</span></button>
          <button class="field-button" data-field="current_address">Current Address <span class="marked-count" id="count_current_address" style="display:none">0</span></button>
          <button class="field-button" data-field="ssn">Social Security Number <span class="marked-count" id="count_ssn" style="display:none">0</span></button>
          <button class="field-button" data-field="date_of_birth">Date of Birth <span class="marked-count" id="count_date_of_birth" style="display:none">0</span></button>
        </div>

        <div class="field-category">
          <div class="category-title">Loan Details</div>
          <button class="field-button" data-field="loan_purpose">Loan Purpose <span class="marked-count" id="count_loan_purpose" style="display:none">0</span></button>
          <button class="field-button" data-field="loan_amount">Requested Amount <span class="marked-count" id="count_loan_amount" style="display:none">0</span></button>
          <button class="field-button" data-field="property_address">Property Address <span class="marked-count" id="count_property_address" style="display:none">0</span></button>
          <button class="field-button" data-field="property_type">Property Type <span class="marked-count" id="count_property_type" style="display:none">0</span></button>
          <button class="field-button" data-field="occupancy">Occupancy Type <span class="marked-count" id="count_occupancy" style="display:none">0</span></button>
          <button class="field-button" data-field="purchase_price">Purchase Price <span class="marked-count" id="count_purchase_price" style="display:none">0</span></button>
        </div>

        <div class="field-category">
          <div class="category-title">Financial Information</div>
          <button class="field-button" data-field="credit_score">Credit Score <span class="marked-count" id="count_credit_score" style="display:none">0</span></button>
          <button class="field-button" data-field="annual_income">Annual Income <span class="marked-count" id="count_annual_income" style="display:none">0</span></button>
          <button class="field-button" data-field="employment_status">Employment Status <span class="marked-count" id="count_employment_status" style="display:none">0</span></button>
          <button class="field-button" data-field="employer_name">Employer Name <span class="marked-count" id="count_employer_name" style="display:none">0</span></button>
          <button class="field-button" data-field="down_payment">Down Payment <span class="marked-count" id="count_down_payment" style="display:none">0</span></button>
          <button class="field-button" data-field="monthly_debts">Monthly Debts <span class="marked-count" id="count_monthly_debts" style="display:none">0</span></button>
        </div>

        <div class="field-category">
          <div class="category-title">Current Mortgage (Refinance)</div>
          <button class="field-button" data-field="current_rate">Current Rate <span class="marked-count" id="count_current_rate" style="display:none">0</span></button>
          <button class="field-button" data-field="current_payment">Current Payment <span class="marked-count" id="count_current_payment" style="display:none">0</span></button>
          <button class="field-button" data-field="current_lender">Current Lender <span class="marked-count" id="count_current_lender" style="display:none">0</span></button>
          <button class="field-button" data-field="years_remaining">Years Remaining <span class="marked-count" id="count_years_remaining" style="display:none">0</span></button>
          <button class="field-button" data-field="cash_out_amount">Cash Out Amount <span class="marked-count" id="count_cash_out_amount" style="display:none">0</span></button>
        </div>

        <div class="field-category">
          <div class="category-title">Timeline & Urgency</div>
          <button class="field-button" data-field="closing_date">Target Closing Date <span class="marked-count" id="count_closing_date" style="display:none">0</span></button>
          <button class="field-button" data-field="preapproval_needed">Pre-approval Needed <span class="marked-count" id="count_preapproval_needed" style="display:none">0</span></button>
          <button class="field-button" data-field="urgency_level">Urgency Level <span class="marked-count" id="count_urgency_level" style="display:none">0</span></button>
          <button class="field-button" data-field="shopping_other_lenders">Shopping Other Lenders <span class="marked-count" id="count_shopping_other_lenders" style="display:none">0</span></button>
        </div>

        <div class="field-category">
          <div class="category-title">Action Items</div>
          <button class="field-button" data-field="follow_up_needed">Follow-up Needed <span class="marked-count" id="count_follow_up_needed" style="display:none">0</span></button>
          <button class="field-button" data-field="documents_needed">Documents Needed <span class="marked-count" id="count_documents_needed" style="display:none">0</span></button>
          <button class="field-button" data-field="questions_concerns">Questions/Concerns <span class="marked-count" id="count_questions_concerns" style="display:none">0</span></button>
          <button class="field-button" data-field="next_steps">Next Steps <span class="marked-count" id="count_next_steps" style="display:none">0</span></button>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn btn-secondary" onclick="clearMarkedFields()">Clear All Marks</button>
      <button class="btn btn-primary" onclick="saveTrainingData()">üíæ Save Training Data</button>
      <button class="btn btn-secondary" onclick="exportTrainingData()">üì• Export Training Set</button>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let currentRecording = null;
    let currentTranscript = null;
    let selectedField = null;
    let markedFields = {};
    let trainingData = {};

    // Load recordings on page load
    window.addEventListener('DOMContentLoaded', () => {
      loadRecordings();
      setupFieldButtons();
      setupTextSelection();
      loadTrainingStats();
    });

    async function loadRecordings() {
      try {
        const response = await fetch('/api/twilio/recordings');
        const data = await response.json();

        if (data.success) {
          displayRecordings(data.recordings);
          document.getElementById('totalRecordings').textContent = data.recordings.length;

          // Count trained recordings
          const trained = data.recordings.filter(r => r.hasTranscription).length;
          document.getElementById('trainedRecordings').textContent = trained;
        }
      } catch (error) {
        console.error('Error loading recordings:', error);
        document.getElementById('recordingsList').innerHTML =
          '<p style="color: red; padding: 20px;">Error loading recordings</p>';
      }
    }

    function displayRecordings(recordings) {
      const container = document.getElementById('recordingsList');

      if (recordings.length === 0) {
        container.innerHTML = '<p style="color: #999; padding: 20px;">No recordings available</p>';
        return;
      }

      container.innerHTML = recordings.map(rec => `
        <div class="recording-item" onclick="selectRecording('${rec.sid}', '${rec.callSid}')">
          <div class="recording-info">
            <div>
              <span class="info-label">Customer:</span>
              <span class="info-value">${rec.customerName}</span>
              ${rec.hasTranscription ? '<span class="status-badge status-trained">Transcribed</span>' : '<span class="status-badge status-pending">Pending</span>'}
            </div>
            <div>
              <span class="info-label">Phone:</span>
              <span class="info-value">${rec.customerPhone}</span>
            </div>
            <div>
              <span class="info-label">Date:</span>
              <span class="info-value">${new Date(rec.dateCreated).toLocaleDateString()}</span>
            </div>
            <div>
              <span class="info-label">Duration:</span>
              <span class="info-value">${rec.duration}s</span>
            </div>
            <div>
              <span class="info-label">Officer:</span>
              <span class="info-value">${rec.loanOfficer}</span>
            </div>
            <div>
              <span class="info-label">ID:</span>
              <span class="info-value" style="font-size: 11px;">${rec.sid.slice(-8)}</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    async function selectRecording(recordingSid, callSid) {
      // Update UI to show selected
      document.querySelectorAll('.recording-item').forEach(item => {
        item.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');

      currentRecording = recordingSid;
      markedFields = {}; // Reset marked fields for new recording
      updateFieldCounts();

      // Load audio
      const audioPlayer = document.getElementById('audioPlayer');
      const audioElement = document.getElementById('audioElement');
      audioElement.src = `/api/twilio/recording/${recordingSid}/stream`;
      audioPlayer.style.display = 'block';

      // Load transcript
      const transcriptViewer = document.getElementById('transcriptViewer');
      transcriptViewer.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading transcript...</p></div>';

      try {
        const response = await fetch(`/api/transcription/${recordingSid}`);
        const data = await response.json();

        if (data.success && data.transcript) {
          currentTranscript = data.transcript;
          displayTranscript(data.transcript);

          // Load any existing training data for this recording
          loadExistingTrainingData(recordingSid);
        } else {
          // Start transcription if not available
          transcriptViewer.innerHTML = '<div class="loading"><div class="spinner"></div><p>Transcription in progress... This may take a few minutes.</p></div>';

          const transcribeResponse = await fetch(`/api/transcription/${recordingSid}/transcribe`, {
            method: 'POST'
          });

          if (transcribeResponse.ok) {
            // Wait for transcription to complete
            setTimeout(() => selectRecording(recordingSid, callSid), 5000);
          }
        }
      } catch (error) {
        console.error('Error loading transcript:', error);
        transcriptViewer.innerHTML = '<p style="color: red; padding: 20px;">Error loading transcript</p>';
      }
    }

    function displayTranscript(transcript) {
      const viewer = document.getElementById('transcriptViewer');

      if (transcript.utterances && transcript.utterances.length > 0) {
        viewer.innerHTML = transcript.utterances.map((utterance, index) => `
          <div class="utterance ${utterance.speaker === 'A' ? 'speaker-a' : 'speaker-b'}" data-index="${index}">
            <div class="speaker-label">Speaker ${utterance.speaker}:</div>
            <div class="utterance-text" data-utterance-index="${index}">${utterance.text}</div>
          </div>
        `).join('');
      } else if (transcript.text) {
        viewer.innerHTML = `
          <div class="utterance">
            <div class="utterance-text">${transcript.text}</div>
          </div>
        `;
      } else {
        viewer.innerHTML = '<p style="color: #999; padding: 20px;">No transcript available</p>';
      }
    }

    function setupFieldButtons() {
      document.querySelectorAll('.field-button').forEach(button => {
        button.addEventListener('click', function() {
          // Remove active from all buttons
          document.querySelectorAll('.field-button').forEach(b => b.classList.remove('active'));

          // Set this button as active
          this.classList.add('active');
          selectedField = this.dataset.field;

          // Update current field indicator
          document.getElementById('currentField').textContent =
            `Marking: ${this.textContent.replace(/\s*\d+$/, '')}`;
        });
      });
    }

    function setupTextSelection() {
      document.addEventListener('mouseup', function(e) {
        if (!selectedField || !currentTranscript) return;

        const selection = window.getSelection();
        const selectedText = selection.toString().trim();

        if (selectedText && e.target.classList.contains('utterance-text')) {
          // Mark the selected text
          markField(selectedText, selectedField, e.target);

          // Clear selection
          selection.removeAllRanges();
        }
      });
    }

    function markField(text, fieldType, element) {
      if (!markedFields[fieldType]) {
        markedFields[fieldType] = [];
      }

      // Store the marked field
      markedFields[fieldType].push({
        text: text,
        utteranceIndex: element.dataset.utteranceIndex
      });

      // Highlight the text in the UI
      const highlighted = `<span class="marked-field" data-field="${fieldType}">${text}<span class="field-tag">${fieldType.replace(/_/g, ' ')}</span></span>`;
      element.innerHTML = element.innerHTML.replace(text, highlighted);

      // Update count
      updateFieldCounts();

      // Show success feedback
      showNotification(`Marked "${text}" as ${fieldType.replace(/_/g, ' ')}`);
    }

    function updateFieldCounts() {
      // Reset all counts
      document.querySelectorAll('.marked-count').forEach(count => {
        count.style.display = 'none';
        count.textContent = '0';
      });

      // Update counts for marked fields
      let totalFields = 0;
      for (const [fieldType, marks] of Object.entries(markedFields)) {
        const countElement = document.getElementById(`count_${fieldType}`);
        if (countElement && marks.length > 0) {
          countElement.style.display = 'inline-block';
          countElement.textContent = marks.length;
          totalFields += marks.length;
        }
      }

      document.getElementById('fieldsMarked').textContent = totalFields;
    }

    function clearMarkedFields() {
      if (!confirm('Clear all marked fields for this recording?')) return;

      markedFields = {};
      if (currentTranscript) {
        displayTranscript(currentTranscript);
      }
      updateFieldCounts();
      showNotification('All marked fields cleared');
    }

    async function saveTrainingData() {
      if (!currentRecording || Object.keys(markedFields).length === 0) {
        alert('Please mark some fields before saving');
        return;
      }

      const trainingData = {
        recordingSid: currentRecording,
        transcript: currentTranscript,
        markedFields: markedFields,
        trainedBy: 'David Young',
        trainedAt: new Date()
      };

      try {
        const response = await fetch('/api/training/save', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(trainingData)
        });

        if (response.ok) {
          showNotification('Training data saved successfully! The AI will learn from these examples.');
          loadTrainingStats();
        } else {
          alert('Error saving training data');
        }
      } catch (error) {
        console.error('Error saving training data:', error);
        alert('Error saving training data');
      }
    }

    async function exportTrainingData() {
      try {
        const response = await fetch('/api/training/export');
        const data = await response.json();

        // Create download link
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `training-data-${new Date().toISOString().split('T')[0]}.json`;
        a.click();

        showNotification('Training data exported successfully');
      } catch (error) {
        console.error('Error exporting training data:', error);
        alert('Error exporting training data');
      }
    }

    async function loadExistingTrainingData(recordingSid) {
      try {
        const response = await fetch(`/api/training/${recordingSid}`);
        if (response.ok) {
          const data = await response.json();
          if (data.markedFields) {
            markedFields = data.markedFields;
            // Re-highlight the marked fields in the transcript
            highlightExistingMarks();
            updateFieldCounts();
          }
        }
      } catch (error) {
        console.error('Error loading existing training data:', error);
      }
    }

    function highlightExistingMarks() {
      // Re-apply highlights to transcript based on loaded markedFields
      for (const [fieldType, marks] of Object.entries(markedFields)) {
        marks.forEach(mark => {
          const utteranceElements = document.querySelectorAll('.utterance-text');
          utteranceElements.forEach(element => {
            if (element.textContent.includes(mark.text)) {
              const highlighted = `<span class="marked-field" data-field="${fieldType}">${mark.text}<span class="field-tag">${fieldType.replace(/_/g, ' ')}</span></span>`;
              element.innerHTML = element.innerHTML.replace(mark.text, highlighted);
            }
          });
        });
      }
    }

    async function loadTrainingStats() {
      try {
        const response = await fetch('/api/training/stats');
        const stats = await response.json();

        if (stats.accuracy) {
          document.getElementById('accuracyScore').textContent = `${Math.round(stats.accuracy)}%`;
        }
      } catch (error) {
        console.error('Error loading training stats:', error);
      }
    }

    function refreshRecordings() {
      loadRecordings();
      showNotification('Recordings refreshed');
    }

    function showNotification(message) {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #667eea;
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 1000;
        animation: slideIn 0.3s ease;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);

      // Remove after 3 seconds
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Listen for new transcriptions
    socket.on('transcription-ready', (data) => {
      if (data.recordingSid === currentRecording) {
        currentTranscript = data.transcription;
        displayTranscript(data.transcription);
        showNotification('Transcription complete!');
      }
      // Refresh recordings list
      loadRecordings();
    });
  </script>
</body>
</html>